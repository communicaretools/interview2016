# Interview assignment 2016
This project contains a simple email-like messaging service, consisting of a nodejs-based backend persisting to mongodb, and an ionic/angularjs mobile app.

All components are realized in docker containers, meaning that to get started, all you have to do is this:

```
$ docker-compose run --rm api npm install
$ docker-compose run --rm client npm install
$ docker-compose up -d
```

Then point your browser to `localhost:8100` for a GUI, or `curl` you way around `localhost:3000/api` to explore the api. The two first commands are not required after the first initialization.

For the rest of this guide, `docker-compose` will be abbreviated as `dc`; if you're on bash, executing `alias dc=docker-compose` will give you the same convenience (stick it in `.bashrc` for persistent joy).

## Backend
The backend consists of a node.js server container with an express.js app, and a mongodb container. For a rationale behind the file-structure of the app, see the readme of [this repository](https://github.com/focusaurus/express_code_structure).

In the `Gulpfile`, there is a simple data generator that seeds the development database with three users (`admin`, `anna` and `don`; all passwords are set to *test*) and a few messages; run it this way:
```
$ dc exec api gulp populate-db
```

When developing, the test server is reloaded automatically when the file system beneath `app/` changes; you can find the api at `localhost:3000`:
```json
$ curl -X GET localhost:3000/api/messages/inbox
{
    "login":"/api/auth/token"
}

$ curl -X POST localhost:3000/api/auth/token \
       -H 'Content-Type: application/json' \
       -d '{"username":"admin", "password":"test"}'
{
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyaWQiOiI1NzUwOGY1MmY0NmZkYTcwMTg2NWQ4NjUiLCJpYXQiOjE0NjQ5MDE0OTksImV4cCI6MTQ2NTUwNjI5OX0.lPqNsYxVajtARztGzAxY3YCNNp9RL-Lr6aBjtS1qaPs"
}

$ curl -X GET localhost:3000/api/messages/inbox \
       -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyaWQiOiI1NzUwOGY1MmY0NmZkYTcwMTg2NWQ4NjUiLCJpYXQiOjE0NjQ5MDE0OTksImV4cCI6MTQ2NTUwNjI5OX0.lPqNsYxVajtARztGzAxY3YCNNp9RL-Lr6aBjtS1qaPs'
[
  {
      "_id":"57508f52f46fda701865d868",
      "subject":"One",
      "body":"Test message"
  },
  {
      "_id":"57508f52f46fda701865d869",
      "subject":"Two",
      "body":"Test message"
  },
  {
      "_id":"57508f52f46fda701865d86a",
      "subject":"Three",
      "body":"Test message"
  }
]
```

Unit tests are provided in jasmine, as that is the default for ionic apps (the client). All files named `*.tests.js` are expected to contain tests, and for better discoverability, test files are located next to the units they test. To run the tests:
```
$ dc exec api gulp test
```

If you need to inspect/edit the database, or empty some of it:
```
$ dc exec mongo mongo msg_api_development
> ...
> db.users.remove()
> db.messages.remove()
> bye
```

## Client
The client is a fairly standard angularjs/ionic app, except that the files are structured per feature/area rather than by framework concept (controllers, views, etc).

Unit tests follow the same conventions as in the backend, with the test files next to the units they test. In order to run unit tests, run:
```
$ dc exec client gulp test
```
...and point your browser at `http://localhost:9876`
